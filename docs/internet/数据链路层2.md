# 数据链路层-2

这篇文章主要说的是属于**随机接入**的以太网。受控接入则由于目前在局域网中使用使用的较少，书中没讲。

## 以太网的两个标准 
+ DIX Ethernet V2 是世界上第一个局域网产品（以太网）的规约。
+ IEEE 802.3 是第一个 IEEE 的以太网标准。
+ DIX Ethernet V2 标准与 IEEE 的 802.3 标准只有很小的差别，因此可以将 802.3 局域网简称为“以太网”。
+ 严格说来，**以太网**应当是指符合 DIX Ethernet V2 标准的局域网 。 

## 以太网中的 CSMA/CD 协议

+ 最初的以太网是将许多计算机都连接到一根总线上。易于实现广播通信。当初认为这样的连接方法既简单又可靠，因为总线上没有有源器件。 

![计算机通过适配器和局域网进行通信](/internet/3-19.png "计算机通过适配器和局域网进行通信")

+ 为了实现一对一通信，将接收站的硬件地址写入帧首部中的目的地址字段中。仅当数据帧中的目的地址与适配器的硬件地址一致时，才能接收这个数据帧。

![计算机通过适配器和局域网进行通信](/internet/3-20.png "计算机通过适配器和局域网进行通信")

+ 总线也有缺点。若多台计算机或多个站点同时发送时，会产生发送碰撞或冲突，导致发送失败。

![计算机通过适配器和局域网进行通信](/internet/3-21.png "计算机通过适配器和局域网进行通信")

### 为了通信的简便，以太网采取了两种重要的措施：
1. 采用较为灵活的无连接的工作方式
    + 不必先建立连接就可以直接发送数据。
    + 对发送的数据帧不进行编号，也不要求对方发回确认。
    + 这样做的理由是局域网信道的质量很好，因信道质量产生差错的概率是很小的。
    
2. 以太网发送的数据都使用曼彻斯特 (Manchester) 编码
    

### 以太网提供的服务
+ 以太网提供的服务是不可靠的交付，即尽最大努力的交付。
+ 当目的站收到有差错的数据帧时就丢弃此帧，其他什么也不做。差错的纠正由高层来决定。
+ 如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新的数据帧来发送。 

### CSMA/CD协议的要点
+ ***CSMA/CD*** 含义：载波监听多点接入 / 碰撞检测  (Carrier Sense Multiple Access with Collision Detection) 。
+ “**多点接入**”表示许多计算机以多点接入的方式连接在一根总线上。
+ “**载波监听**”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。 
+ 总线上并没有什么“载波”。因此， “载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。
![耳机分割线](/line2.png "耳机分割线")
+ “**碰撞检测**”就是计算机边发送数据边检测信道上的信号电压大小。
+ 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）。
+ 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。
+ 所谓“碰撞”就是发生了冲突。因此“碰撞检测”也称为“冲突检测”。
+ 在发生碰撞时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来。
+ 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送，免得继续浪费网络资源，然后等待一段随机时间后再次发送。

![CSMA/CD 协议工作流程](/internet/3-22.png "CSMA/CD 协议工作流程")

### 传播时延对载波监听影响

+ 最先发送数据帧的站，在发送数据帧后至多经过时间 $2\tau$（两倍的端到端往返时延）就可知道发送的数据帧是否遭受了碰撞。
+ 以太网的端到端往返时延 $2\tau$ 称为争用期，或碰撞窗口。
+ 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。

### 二进制指数类型退避算法 (truncated binary exponential type)
发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据。
+ 基本退避时间取为争用期 $2\tau$ 。
+ 从整数集合 [0, 1, … , (2k - 1)] 中随机地取出一个数，记为 r。重传所需的时延就是 r 倍的基本退避时间。
+ 参数 k 按下面的公式计算：（其中 m 为重传次数）
$$k = Min[m, 10]$$
+ 当 k ≤10 时，参数 k 等于重传次数。
+ 当重传达 16 次仍不能成功时即丢弃该帧，并向高层报告。 

### 10 Mbit/s 以太网争用期的长度
+ 10 Mbit/s 以太网取 51.2 $\mu s$ 为争用期的长度。
+ 对于 10 Mbit/s 以太网，在争用期内可发送 512 bit，即 64 字节。
这意味着：**以太网在发送数据时，若前 64 字节没有发生冲突，则后续的数据就不会发生冲突**。
+ 如果发生冲突，就一定是在发送的前 64 字节之内。 
+ 由于一检测到冲突就立即中止发送，这时已经发送出去的数据一定小于 64 字节。 
+ 以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧。
### CSMA/CD 重要特性
+ 使用 CSMA/CD 协议的以太网不能进行全双工通信而只能进行**双向交替通信**（半双工通信）。
+ 每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。 
+ 这种发送的不确定性使整个以太网的平均通信量远小于以太网的最高数据率。 
![CSMA/CD协议的要点](/internet/3-23.png "CSMA/CD 协议的要点")

## 使用集线器的星形拓扑
+ 传统以太网最初是使用粗同轴电缆，后来演进到使用比较便宜的细同轴电缆，最后发展为使用更便宜和更灵活的双绞线。
![传统以太网](/internet/3-24.png "传统以太网")

+ 采用双绞线的以太网采用星形拓扑，在星形的中心则增加了一种可靠性非常高的设备，叫做**集线器** (hub)。
![使用集线器的双绞线以太网](/internet/3-25.png "使用集线器的双绞线以太网")



## 以太网的信道利用率

## 以太网的 MAC 层


## 扩展的以太网

## 高速以太网
