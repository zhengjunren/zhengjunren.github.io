(window.webpackJsonp=window.webpackJsonp||[]).push([[150],{723:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),t("p",[t("strong",[s._v("注意：在搭建此服务器之前，请准备一台干净的centos，在安装时，将主机名设置为localhost！！！！！！！！！！不然很有可能失败！")])]),s._v(" "),t("p",[s._v("本文中，dns服务器使用的是"),t("code",[s._v("bind")]),s._v("，邮件服务器使用的是"),t("code",[s._v("sendmail")]),s._v("，"),t("code",[s._v("dovecot")]),s._v("。\n其中"),t("code",[s._v("centos")]),s._v("的 IP 地址为："),t("code",[s._v("192.168.223.131")])]),s._v(" "),t("h2",{attrs:{id:"关闭防火墙"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[s._v("#")]),s._v(" 关闭防火墙")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭")]),s._v("\nsystemctl stop firewalld\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭")]),s._v("\nsystemctl disable firewalld \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看防火墙状态")]),s._v("\nsystemctl status  firewalld \n")])])]),t("h2",{attrs:{id:"安装配置-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装配置-dns"}},[s._v("#")]),s._v(" 安装配置 DNS")]),s._v(" "),t("p",[s._v("首先，查看系统中是否已经安装了"),t("code",[s._v("bind")]),s._v(",查看命令如下：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -qa "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("\n")])])]),t("p",[s._v("如果安装了则显示如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/linux/bind1.PNG",alt:"已经安装bind",title:"已经安装bind"}})]),s._v(" "),t("p",[s._v("如果无显示，则表示未安装，输入下面的命令安装：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("\n")])])]),t("p",[s._v("安装完成之后就可以开始配置了：")]),s._v(" "),t("p",[s._v("打开"),t("code",[s._v("/etc/named.conf")]),s._v("，找到下图中圈中的地方")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/named.conf\n")])])]),t("p",[t("img",{attrs:{src:"/linux/bind2.PNG",alt:"配置bind",title:"配置bind"}}),s._v("\n修改为：（注意：只用改这三处，其他别改）")]),s._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("listen-on port 53 { any; };\n        listen-on-v6 port 53 { any; };\n/*\n...\n*/\nallow-query     { any; };\n")])])]),t("p",[s._v("接着，打开"),t("code",[s._v("/etc/named.rfc1912.zones")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/named.rfc1912.zones\n")])])]),t("p",[s._v("打开之后，你会看见有很多这种格式的配置，你可以将它清空，使用下面这个模板：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('zone "localhost.localdomain" IN {\n        type master;\n        file "named.localhost";\n        allow-update { none; };\n};\n\n\nzone "1.0.0.127.in-addr.arpa" IN {\n        type master;\n        file "named.loopback";\n        allow-update { none; };\n};\n')])])]),t("p",[s._v("将模板内容更改为：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('zone "zjr.com" IN {\n        type master;\n        file "zjr.localhost";\n        allow-update { none; };\n};\nzone "223.168.192.in-addr.arpa" {\n        type master;\n        file "zjr.loopback";\n        allow-update { none; };\n};\n')])])]),t("p",[s._v("其中高亮行的数字是本网段反过来写，如你的网段是"),t("code",[s._v("192.168.76")]),s._v("，则将第六行数字改为"),t("code",[s._v("76.168.192")]),s._v("。")]),s._v(" "),t("p",[s._v("修改完成后，进入到"),t("code",[s._v("/var/named")]),s._v("目录下，执行如下两条复制命令：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cp -a named.localhost zjr.localhost\ncp -a named.localhost zjr.loopback\n")])])]),t("p",[s._v("打开"),t("code",[s._v("zjr.localhost")]),s._v(",可以看到：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$TTL 1D\n@       IN SOA  @ rname.invalid. (\n                                        0       ; serial\n                                        1D      ; refresh\n                                        1H      ; retry\n                                        1W      ; expire\n                                        3H )    ; minimum\n        NS      @\n        A       127.0.0.1\n        AAAA    ::1\n")])])]),t("p",[s._v("将其修改为：("),t("strong",[s._v("注意高亮行的 . 不能少")]),s._v(")")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$TTL 1D\n@       IN SOA  zjr.com. rname.invalid. (\n                                        0       ; serial\n                                        1D      ; refresh\n                                        1H      ; retry\n                                        1W      ; expire\n                                        3H )    ; minimum\n        NS      dns.zjr.com.\n        IN MX 10 pop.zjr.com.\n        IN MX 10 smtp.zjr.com.\ndns     A       192.168.223.131\n@       A       192.168.223.131\nwww     A       192.168.223.131\npop     A       192.168.223.131\nsmtp    A       192.168.223.131\n")])])]),t("p",[s._v("接着打开"),t("code",[s._v("zjr.loopback")]),s._v(",可以看到：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$TTL 1D\n@       IN SOA  @ rname.invalid. (\n                                        0       ; serial\n                                        1D      ; refresh\n                                        1H      ; retry\n                                        1W      ; expire\n                                        3H )    ; minimum\n        NS      @\n        A       127.0.0.1\n        AAAA    ::1\n")])])]),t("p",[s._v("修改为：("),t("strong",[s._v("注意域名后面的.不能少，此外"),t("code",[s._v("131")]),s._v("是我的主机号，即ip地址的最后一个字段")]),s._v(")")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$TTL 1D\n@       IN SOA  zjr.com. rname.invalid. (\n                                        0       ; serial\n                                        1D      ; refresh\n                                        1H      ; retry\n                                        1W      ; expire\n                                        3H )    ; minimum\n        NS      dns.zjr.com.\n131     PTR     dns.zjr.com.\n131     PTR     pop.zjr.com.\n131     PTR     smtp.zjr.com.\n")])])]),t("p",[s._v("其次，打开"),t("code",[s._v("/etc/sysconfig/network-scripts/ifcfg-ens33")]),s._v("文件，(ens33是网卡名称)\n在文件中增加如下一行配置：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('DNS1 = "127.0.0.1"\n')])])]),t("p",[s._v("最后，检查是否配置成功：")]),s._v(" "),t("p",[s._v("先重启"),t("code",[s._v("named")]),s._v("和"),t("code",[s._v("network")]),s._v("服务：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" named restart\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" network restart\n")])])]),t("p",[s._v("再执行如下命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nslookup")]),s._v(" zjr.com\n")])])]),t("p",[s._v("若输出如下命令，则表示配置成功：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Server:\t\t127.0.0.1\nAddress:\t127.0.0.1#53\n\nName:\tzjr.com\nAddress: 192.168.223.131\n")])])]),t("p",[s._v("打开"),t("code",[s._v("/etc/sysconfig/network")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sysconfig/network\n")])])]),t("p",[s._v("增加：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("localhost.localdomain\n")])])]),t("p",[s._v("修改主机名：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("hostnamectl set-hostname zjr.com\n")])])]),t("h2",{attrs:{id:"安装配置-sendmail"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装配置-sendmail"}},[s._v("#")]),s._v(" 安装配置 sendmail")]),s._v(" "),t("p",[s._v("首先，查看系统中是否已经安装了"),t("code",[s._v("sendmail")]),s._v(",查看命令如下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("rpm -qa | grep sendmail\n")])])]),t("p",[s._v("安装命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendmail")]),s._v(" sendmail-cf\n")])])]),t("p",[s._v("进入"),t("code",[s._v("/etc/mail")]),s._v("目录，打开"),t("code",[s._v("access")]),s._v("文件")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/mail\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" access\n")])])]),t("p",[s._v("修改为：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Connect:localhost.localdomain           RELAY\nConnect:localhost                       RELAY\nConnect:127.0.0.1                       RELAY\nConnect:zjr.com                         RELAY\nConnect:192.168.223.*                   RELAY\n")])])]),t("p",[s._v("在执行如下命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("makemap "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" access.db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" access\n")])])]),t("p",[s._v("打开"),t("code",[s._v("sendmail.mc")]),s._v(",找到下图中处：\n"),t("img",{attrs:{src:"/linux/sendmail1.PNG",alt:"sendmail1",title:"sendmail1"}}),s._v("\n改为：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("DAEMON_OPTIONS(`Port=smtp,Addr=0.0.0.0, Name=MTA')dnl\n")])])]),t("p",[s._v("再执行下面这条命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("m4  sendmail.mc  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" sendmail.cf\n")])])]),t("p",[s._v("检查：先重新启动，在查看端口监听：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("systemctl restart sendmail.service\n\nnetstat -an | grep 25\n")])])]),t("p",[s._v("结果如下：\n"),t("img",{attrs:{src:"/linux/sendmail2.PNG",alt:"sendmail1",title:"sendmail1"}})]),s._v(" "),t("h2",{attrs:{id:"安装配置-dovecot"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装配置-dovecot"}},[s._v("#")]),s._v(" 安装配置 dovecot")]),s._v(" "),t("p",[s._v("首先，查看系统中是否已经安装了"),t("code",[s._v("dovecot")]),s._v(",查看命令如下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("rpm -qa | grep dovecot\n")])])]),t("p",[s._v("安装命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" dovecot\n")])])]),t("p",[s._v("接着打开"),t("code",[s._v("/etc/dovecot/dovecot.conf")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/dovecot/dovecot.conf\n")])])]),t("p",[s._v("找到下图中圈出的那条配置，将"),t("code",[s._v("#")]),s._v("删除")]),s._v(" "),t("p",[t("img",{attrs:{src:"/linux/dovecot1.PNG",alt:"dovecot",title:"dovecot"}})]),s._v(" "),t("p",[s._v("进入"),t("code",[s._v("/etc/dovecot/conf.d")]),s._v("文件夹：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/dovecot/conf.d\n")])])]),t("p",[s._v("打开"),t("code",[s._v("10-auth.conf")]),s._v(",将下图圈起的地方改为：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-auth.conf\n")])])]),t("p",[t("img",{attrs:{src:"/linux/dovecot2.PNG",alt:"dovecot",title:"dovecot"}})]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("disable_plaintext_auth = no\n")])])]),t("p",[s._v("再打开"),t("code",[s._v("10-mail.conf")]),s._v(",将下图圈起的地方改为(就是把"),t("code",[s._v("#")]),s._v("去掉）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-mail.conf\n")])])]),t("p",[t("img",{attrs:{src:"/linux/dovecot3.PNG",alt:"dovecot",title:"dovecot"}})]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("mail_location = mbox:~/mail:INBOX=/var/mail/%u\n")])])]),t("p",[s._v("打开"),t("code",[s._v("10-ssl.conf")]),s._v(",将下图圈起的地方改为：\n"),t("img",{attrs:{src:"/linux/dovecot4.PNG",alt:"dovecot",title:"dovecot"}})]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ssl = no\n")])])]),t("h2",{attrs:{id:"测试和结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试和结果"}},[s._v("#")]),s._v(" 测试和结果")]),s._v(" "),t("p",[s._v("重启"),t("code",[s._v("sendmail")]),s._v("和"),t("code",[s._v("dovecot")]),s._v("服务")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("systemctl restart sendmail.service\n\n\nsystemctl restart dovecot.service\n")])])]),t("p",[s._v("新增用户两个用户"),t("code",[s._v("user1")]),s._v("和"),t("code",[s._v("user2")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" user1\n")])])]),t("p",[s._v("设置密码：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("passwd")]),s._v(" user1\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("提示")]),t("p",[s._v("在设置密码过程中，会提示密码不符合规范等什么鬼的原因，直接忽略，只用两次密码相同即可。")])]),t("p",[s._v("再创建 "),t("code",[s._v("/home/user1/mail/.imap/INBOX")]),s._v("和"),t("code",[s._v("/home/user2/mail/.imap/INBOX")]),s._v("文件夹，如果不能一次创建，请一级一级创建。\n在"),t("strong",[s._v("分别")]),s._v("进入到两"),t("code",[s._v("INBOX")]),s._v("文件夹，"),t("strong",[s._v("分别")]),s._v("执行如下两条命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R user1 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R user2 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("此时，打开windows系统的虚拟机，将windows中的DNS服务器设置为"),t("code",[s._v("192.168.223.131")]),s._v("。打开"),t("code",[s._v("Foxmail")]),s._v(":\n"),t("img",{attrs:{src:"/linux/result1.PNG",alt:"result",title:"result"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);